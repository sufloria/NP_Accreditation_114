import streamlit as st
import json
import os

# ç¶²é é…ç½®
st.set_page_config(page_title="114å¹´å°ˆå¸«èªå®šè‡ªæª¢-çµ‚æ¥µå®Œæ•´ç‰ˆ", layout="wide")

# 1. æ ¸å¿ƒè³‡æ–™åº«ï¼šå®Œæ•´ 23 é …æ¢æ–‡ã€ä½è­‰ã€è¨ªè«‡é¡Œ 
def get_full_criteria():
    return [
        # --- ç¬¬ 1 ç« ï¼šæ•™å­¸è³‡æºèˆ‡çµ„ç¹”ç®¡ç† ---
        {"id": "1.1.1", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "å°ˆè²¬åŸ¹è‚²èˆ‡ç®¡ç†å–®ä½", "c_level": "å‰¯é™¢é•·ç´šå¬é›†äººï¼Œé†«è­·å…±åŒçµ„æˆï¼Œæ¯3å€‹æœˆé–‹æœƒ1æ¬¡ [cite: 104, 256]ã€‚", "check": ["çµ„ç¹”æ¶æ§‹åŠæˆå“¡åå–®", "æœƒè­°ç´€éŒ„(è¿‘ä¸€å¹´4æ¬¡)", "åŸ·æ¥­åŠå‹å‹•æ¬Šç›Šç¶­è­·è³‡æ–™"], "q": "å¬é›†äººç´šåˆ¥ç‚ºä½•ï¼Ÿæœƒè­°æ˜¯å¦åŒ…å«å‹å‹•æ¬Šç›Šè­°é¡Œï¼Ÿ"},
        {"id": "1.1.2", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "æ˜ç¢ºä¹‹åŸ·æ¥­å…§å®¹", "c_level": "ä¾è¾¦æ³•è¨‚å®šå„åˆ†ç§‘é†«ç™‚æ¥­å‹™ç¯„åœã€é …ç›®åŠç‰¹å®šè¨“ç·´ä¸¦å…¬å‘Š [cite: 115, 256]ã€‚", "check": ["åˆ†ç§‘å¯åŸ·è¡Œé†«ç™‚æ¥­å‹™è¦ç¯„", "å·¥ä½œå¥‘ç´„æ›¸(æˆ–æˆæ¬Šæ–‡ä»¶)", "é†«é™¢å…¬å‘Šå‘¨çŸ¥è­‰æ˜"], "q": "å¦‚ä½•ç¢ºä¿æ¥­å‹™é …ç›®ä¸è¶…å‡ºè¡›ç¦éƒ¨é™„è¡¨ç¯„åœï¼Ÿ"},
        {"id": "1.1.3", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "é ç«‹é†«ç™‚æµç¨‹ (PMP) SOP", "c_level": "å‰¯é™¢é•·å¬é›†å§”å“¡æœƒï¼Œé†«å¸«é ˆæ–¼24å°æ™‚å…§å®Œæˆæ ¸ç°½ [cite: 121, 266]ã€‚", "check": ["é ç«‹é†«ç™‚æµç¨‹ SOP", "24å°æ™‚å…§æ ¸ç°½ç´€éŒ„", "å§”å“¡æœƒåå–®åŠé‹ä½œ"], "q": "é†«å¸«æ˜¯å¦ç¢ºå¯¦æ–¼ 24 å°æ™‚å…§å®Œæˆæ ¸å°åŠç°½ç½²ï¼Ÿ"},
        {"id": "1.1.4", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "ç—…æ­·æ›¸å¯«å¯©æŸ¥æ©Ÿåˆ¶", "c_level": "ä¸»æ²»é†«å¸«å°å°ˆå¸«ç—…æ­·è¨˜è¼‰çµ¦äºˆæŒ‡å° [cite: 127, 275]ã€‚", "check": ["ç—…æ­·æ›¸å¯«å¯©æŸ¥æ©Ÿåˆ¶è¦ç¯„", "é†«å¸«æŒ‡å°æˆ–å¯©æŸ¥ç´€éŒ„"], "q": "ä¸»æ²»é†«å¸«å¦‚ä½•å°ç—…æ­·è¨˜è¼‰æä¾›æŒ‡å°ï¼Ÿ"},
        {"id": "1.1.5", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "è‡¨åºŠåŸ·æ¥­å“è³ªç›£æ¸¬", "c_level": "è¨‚æœ‰è‡¨åºŠåŸ·æ¥­å“è³ªç›£æ¸¬è¦ç¯„ã€è¾¦æ³•åŠæ©Ÿåˆ¶ [cite: 131, 275]ã€‚", "check": ["å“è³ªç›£æ¸¬è¾¦æ³•", "å…·é«”ç›£æ¸¬æŒ‡æ¨™èˆ‡ä½è­‰"], "q": "ç›®å‰ç›£æ¸¬çš„æŒ‡æ¨™èˆ‡å…·é«”ç¯„åœç‚ºä½•ï¼Ÿ"},
        {"id": "1.1.6", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "å°ˆå¸«è€ƒæ ¸æ©Ÿåˆ¶", "c_level": "è¨‚æœ‰è€ƒæ ¸æ©Ÿåˆ¶ä¸”ç”±é†«è­·éƒ¨é–€å…±åŒè² è²¬ [cite: 135, 275]ã€‚", "check": ["è€ƒæ ¸è¦ç¯„(åŸºæº–æˆ–è¦é»)", "é†«è­·å…±åŒè€ƒæ ¸åŸ·è¡Œç´€éŒ„"], "q": "è€ƒè©•æ˜¯å¦è½å¯¦ç”±é†«ç™‚èˆ‡è­·ç†ä¸»ç®¡å…±åŒåŸ·è¡Œï¼Ÿ"},
        {"id": "1.2.1", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "å¦¥é©çš„è¨“ç·´å ´æ‰€", "c_level": "æä¾›å…¼é¡§éš±ç§ã€å®‰å…¨èˆ‡å­¸ç¿’ä¾¿åˆ©æ€§ä¹‹å ´æ‰€ [cite: 140, 275]ã€‚", "check": ["è‡¨åºŠè¨“ç·´å ´æ‰€è¨­æ–½", "äººå“¡å·¥ä½œå®‰å…¨ç…§è­·ç­–ç•¥"], "q": "å¯¦åœ°è§€å¯Ÿå ´æ‰€æ˜¯å¦å…¼é¡§ç—…äººå®‰å…¨èˆ‡éš±ç§ï¼Ÿ"},
        {"id": "1.2.2", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "å¿…é ˆä¹‹è¨“ç·´è¨­å‚™", "c_level": "æä¾›è¨“ç·´æ‰€éœ€è¨­å‚™(å«ç¶²è·¯å¹³å°ã€æ–‡ç»æª¢ç´¢) [cite: 145, 285]ã€‚", "check": ["ç¡¬é«”è¨­å‚™èˆ‡ç’°å¢ƒ", "ç¶²è·¯å­¸ç¿’å¹³å°èˆ‡æª¢ç´¢ç³»çµ±"], "q": "è‡¨åºŠå–®ä½æ˜¯å¦èƒ½éš¨æ™‚ä½¿ç”¨å­¸ç¿’å¹³å°ï¼Ÿ"},
        {"id": "1.2.3", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "åœ–æ›¸èˆ‡æœŸåˆŠç®¡ç†", "c_level": "æä¾›è³¼ç½®å€«ç†ã€å¯¦è­‰ç­‰è¿‘5å¹´å…§åœ–æ›¸åŠæœŸåˆŠ [cite: 149, 285]ã€‚", "check": ["åœ–æ›¸è³‡æºæ¸…å–®(å«é›»å­ç‰ˆ)", "æ–°è³¼å…¬å‘Šç´€éŒ„(ç¶²é æˆ–Email)"], "q": "æ˜¯å¦äº†è§£æ–°è³¼åœ–æ›¸æœŸåˆŠä¹‹å…¬å‘Šç®¡é“ï¼Ÿ"},

        # --- ç¬¬ 2 ç« ï¼šæ•™å­¸å¸«è³‡ã€åŸ¹è‚²èˆ‡ç¹¼çºŒæ•™è‚² ---
        {"id": "2.1.1", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "é†«å¸«å¸«è³‡è³‡æ ¼", "c_level": "å…·å°ˆç§‘é†«å¸«è³‡æ ¼ï¼Œå¯¦éš›å¾äº‹å°ˆç§‘å·¥ä½œè‡³å°‘2å¹´ [cite: 155, 296]ã€‚", "check": ["é†«å¸«è­‰æ›¸å½±æœ¬", "æœå‹™å¹´è³‡è­‰æ˜"], "q": "é†«å¸«è³‡æ­·æ˜¯å¦ç¬¦åˆè¦ç¯„ä¹‹å¹´è³‡è¦æ±‚ï¼Ÿ"},
        {"id": "2.1.2", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "å°ˆå¸«å¸«è³‡è³‡æ ¼", "c_level": "å…·å°ˆå¸«è³‡æ ¼ï¼Œå¯¦éš›å¾äº‹å°ˆå¸«å·¥ä½œè‡³å°‘2å¹´ [cite: 160, 296]ã€‚", "check": ["å°ˆå¸«è­‰æ›¸å½±æœ¬", "è‡¨åºŠæœå‹™å¹´è³‡è­‰æ˜"], "q": "æ“”ä»»æ•™å¸«ä¹‹å°ˆå¸«æ˜¯å¦å‡å…·å‚™ 2 å¹´ä»¥ä¸Šå¹´è³‡ï¼Ÿ"},
        {"id": "2.1.3", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "é…ç½®æ¯”èˆ‡å“è³ª", "c_level": "é†«å¸«:å°ˆå¸«:å­¸å“¡æ¯”ä¾‹é ˆç¬¦åˆ 1:4:4 [cite: 165, 296]ã€‚", "check": ["é…ç½®æ¯”ä¾‹çµ±è¨ˆè¡¨", "å¸«è³‡æ•™å­¸æˆæ•ˆè©•å€¼"], "q": "ç›®å‰å„å–®ä½ä¹‹å¸«ç”Ÿæ¯”æ˜¯å¦è½åœ¨ 1:4:4 ç¯„åœï¼Ÿ"},
        {"id": "2.2.1", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "å¸«è³‡åŸ¹è‚²åˆ¶åº¦", "c_level": "æ˜è¨‚åŸ¹è¨“åˆ¶åº¦ã€ç™¼å±•è¨ˆç•«èˆ‡ç›¸é—œé€²ä¿®æ´»å‹• [cite: 172, 303]ã€‚", "check": ["å¸«è³‡ç™¼å±•è¨ˆç•«æ›¸", "æ•™å¸«åƒèˆ‡é€²ä¿®è¨“ç·´ç´€éŒ„"], "q": "é†«é™¢å¦‚ä½•åŸ·è¡Œæ•™å¸«æ•™å­¸èƒ½åŠ›çš„åŸ¹è‚²ï¼Ÿ"},
        {"id": "2.2.2", "is_mandatory": False, "chapter": "ç¬¬äºŒç« ", "title": "å¸«è³‡æ•™å­¸èƒ½åŠ›æå‡", "c_level": "è‡¨åºŠæ•™å¸«åƒèˆ‡èª²ç¨‹è‡³å°‘4å°æ™‚ï¼Œåƒèˆ‡ç‡é”100% [cite: 177, 309]ã€‚", "check": ["æ•™å¸«åƒèˆ‡æ•™å­¸èª²ç¨‹ç´€éŒ„", "èª²å¾Œæˆæ•ˆè©•ä¼°åŠæª¢è¨"], "q": "æŒ‡å°æ•™å¸«æ˜¯å¦çš†å®Œæˆå¹´åº¦ 4 å°æ™‚è¨“ç·´ï¼Ÿ"},
        {"id": "2.2.3", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "å°ˆå¸«ç¹¼çºŒæ•™è‚²åˆ¶åº¦", "c_level": "è¦åŠƒæ¯å¹´è‡³å°‘è¾¦ç†20å°æ™‚ç¹¼çºŒæ•™è‚²èª²ç¨‹ [cite: 186, 316]ã€‚", "check": ["ç¹¼çºŒæ•™è‚²è¨ˆç•«", "èƒ½åŠ›é€²éšåˆ¶åº¦åŸ·è¡Œç´€éŒ„"], "q": "èª²ç¨‹å®‰æ’æ˜¯å¦è¶³ä»¥ç¶­æŒå°ˆå¸«åŸ·ç…§æ•ˆæœŸï¼Ÿ"},

        # --- ç¬¬ 3 ç« ï¼šæ•™å­¸è¨“ç·´è¨ˆç•«èˆ‡åŸ·è¡Œæˆæœ ---
        {"id": "3.1.1", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "æ•™å­¸è¨ˆç•«å…·é«”å¯è¡Œ", "c_level": "è¨ˆç•«å«ç›®çš„ã€ç›®æ¨™ã€èª²ç¨‹ã€å“è³ªç¶­è­·åŠè©•å€¼ [cite: 192, 320]ã€‚", "check": ["å¹´åº¦æ•™å­¸è¨“ç·´è¨ˆç•«æ›¸", "è¨ˆç•«è¨è«–ä¿®è¨‚ç´€éŒ„"], "q": "è¨“ç·´è¨ˆç•«å…§å®¹å¦‚ä½•å¯¦éš›æ‡‰ç”¨æ–¼è‡¨åºŠç…§è­·ï¼Ÿ"},
        {"id": "3.1.2", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "èª²ç¨‹å…§å®¹åŠæ´»å‹•å®‰æ’", "c_level": "ä¾èƒ½åŠ›å®‰æ’èª²ç¨‹ï¼Œåˆç†å…¼é¡§å­¸ç¿’èˆ‡å·¥ä½œéœ€è¦ [cite: 199, 320]ã€‚", "check": ["æ•™å­¸æ´»å‹•æ™‚ç¨‹è¡¨", "è£œè¨“æªæ–½èˆ‡åæ˜ ç´€éŒ„"], "q": "å¦‚ä½•ç¢ºä¿è¨“ç·´æ™‚æ•¸ä¸è¢«è‡¨åºŠå·¥ä½œæ’æ“ ï¼Ÿ"},
        {"id": "3.2.1", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "èª²ç¨‹ç¬¦åˆç”„å¯©è¾¦æ³•", "c_level": "èª²ç¨‹æ‡‰ç¬¦åˆå°ˆç§‘è­·ç†å¸«åˆ†ç§‘åŠç”„å¯©è¾¦æ³•è¦å®š [cite: 205, 327]ã€‚", "check": ["æ•™å­¸è¨ˆç•«æ›¸æ³•è¦æ¯”å°", "å®šæœŸæª¢è¨åŸ·è¡Œæˆæ•ˆ"], "q": "èª²ç¨‹è¦åŠƒæ˜¯å¦å®Œæ•´æ¶µè“‹æ³•è¦è¦æ±‚çš„å…§å®¹ï¼Ÿ"},
        {"id": "3.2.2", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "è‡¨åºŠå¯¦å‹™è¨“ç·´è½å¯¦", "c_level": "åæ˜ å­¸ç¿’ç›®æ¨™ï¼Œå…·æª¢è¨æ”¹å–„æ©Ÿåˆ¶ï¼Œè½å¯¦åŸ·è¡Œ [cite: 211, 327]ã€‚", "check": ["è¨“ç·´éç¨‹ç”¢å‡ºæˆæœ", "æª¢è¨åŠæ”¹å–„ä¹‹è­‰æ“š"], "q": "å¦‚ä½•è­‰æ˜æ•™å­¸æ´»å‹•ç¢ºå¯¦è½å¯¦æ–¼è‡¨åºŠï¼Ÿ"},
        {"id": "3.3.1", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "å›é¥‹èˆ‡åæ˜ ç®¡é“", "c_level": "æ•™å¸«å³æ™‚å›é¥‹ï¼Œè¨­æœ‰æºé€šç®¡é“ç¶­è­·å­¸å“¡æ¬Šç›Š [cite: 216, 327]ã€‚", "check": ["å¸«ç”Ÿè¼”å°å›é¥‹ç´€éŒ„", "åæ˜ å•é¡Œæºé€šè­‰æ˜"], "q": "å­¸å“¡é‡åˆ°å›°é›£æ™‚æœ‰å“ªäº›æ­£å¼ç”³è¨´ç®¡é“ï¼Ÿ"},
        {"id": "3.3.2", "is_mandatory": False, "chapter": "ç¬¬ä¸‰ç« ", "title": "æ•™å¸«å¤šå…ƒåŒ–è©•ä¼°", "c_level": "è¨‚æœ‰è©•ä¼°æ•™å­¸æˆæ•ˆæ©Ÿåˆ¶ä¸¦å¯¦éš›åŸ·è¡Œ [cite: 220, 335]ã€‚", "check": ["è©•ä¼°æ©Ÿåˆ¶æ–‡ä»¶", "å›é¥‹æ•™å¸«èˆ‡è¼”å°ç´€éŒ„"], "q": "å¦‚ä½•è©•ä¼°é†«å¸«èˆ‡å°ˆå¸«å°å¸«çš„æ•™å­¸æˆæ•ˆï¼Ÿ"},
        {"id": "3.3.3", "is_mandatory": False, "chapter": "ç¬¬ä¸‰ç« ", "title": "å­¸å“¡è¨“ç·´æˆæœåˆ†æ", "c_level": "è©•ä¼°åˆ†æå­¸å“¡çµæœä¸¦é€²è¡Œæ”¹å–„èˆ‡è¼”å° [cite: 228, 335]ã€‚", "check": ["è¨“ç·´æˆæœåˆ†æå ±å‘Š", "æˆæ•ˆä¸ä½³è¼”å°ç´€éŒ„"], "q": "å­¸ç¿’æˆæ•ˆåˆ†æå¾Œæ˜¯å¦æœ‰å…·é«”è¼”å°æªæ–½ï¼Ÿ"},
        {"id": "3.3.4", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "è¨“ç·´è¨ˆç•«æˆæ•ˆè©•ä¼°", "c_level": "è¨‚æœ‰å…·é«”è©•å€¼è¨ˆç•«ä¸”æ¯å¹´æª¢è¨(å«è€ƒç…§ç‡) [cite: 232, 344]ã€‚", "check": ["è©•å€¼åˆ†æå ±å‘Š", "è€ƒç…§é€šéç‡çµ±è¨ˆ"], "q": "è€ƒç…§ç‡åˆ†ææ˜¯å¦ä½œç‚ºè¨ˆç•«ä¿®è¨‚ä¹‹ä¾æ“šï¼Ÿ"}
    ]

SAVE_FILE = 'progress.json'
def load_progress():
    if os.path.exists(SAVE_FILE):
        try:
            with open(SAVE_FILE, 'r', encoding='utf-8') as f: return json.load(f)
        except: return {}
    return {}

def save_progress(progress):
    with open(SAVE_FILE, 'w', encoding='utf-8') as f: json.dump(progress, f, ensure_ascii=False)

st.title("ğŸ›¡ï¸ 114å¹´åº¦å°ˆç§‘è­·ç†å¸«è¨“ç·´é†«é™¢èªå®š-çµ‚æ¥µè‡ªæª¢ç³»çµ±")

all_data = get_full_criteria()
saved_progress = load_progress()
user_data = {}

st.sidebar.header("ğŸ“Š èªå®šåˆ¤å®šçµæœ")

tab_chk, tab_time = st.tabs(["ğŸ“‹ å®Œæ•´æ¢æ–‡èˆ‡å¤šé‡ä½è­‰", "â±ï¸ è¨ªè¦–æ™‚ç¨‹è¡¨"])

with tab_chk:
    for chap_name in ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« "]:
        st.subheader(f"ğŸ“ {chap_name}")
        chap_data = [d for d in all_data if d['chapter'] == chap_name]
        for item in chap_data:
            badge = " (å¿…)" if item['is_mandatory'] else ""
            with st.expander(f"{item['id']} {item['title']}{badge}"):
                st.write(f"**ã€Cç­‰ç´šæ¨™æº–ã€‘**ï¼š{item['c_level']}")
                st.warning(f"ğŸ¤ {item['q']}")
                
                old_item_data = saved_progress.get(item['id'], {})
                
                # è² è²¬äººé¸æ“‡èˆ‡æ‰‹å‹•è¼¸å…¥
                roles = ["æœªæŒ‡æ´¾", "è¡Œæ”¿çµ„", "æ•™å­¸çµ„", "è‡¨åºŠçµ„", "å­¸è¡“çµ„é•·", "å…¶ä»–"]
                saved_res = old_item_data.get("res", "æœªæŒ‡æ´¾")
                def_idx = roles.index(saved_res) if saved_res in roles else 5
                
                c1, c2 = st.columns([1, 1])
                with c1:
                    sel_role = st.selectbox(f"ğŸ‘¤ è² è²¬äºº ({item['id']})", roles, index=def_idx, key=f"sel_{item['id']}")
                    final_res = sel_role
                    if sel_role == "å…¶ä»–" or (saved_res and saved_res not in roles):
                        final_res = st.text_input("âœï¸ å¡«å¯«å§“å", value=saved_res if saved_res not in roles else "", key=f"res_{item['id']}")

                # æ”¯æ´å¤šå€‹é€£çµ
                st.write("**ğŸ“‘ ä½è­‰ç´°é …æ ¸å° (å¤šé€£çµè«‹ç”¨è‹±æ–‡é€—è™Ÿ , åˆ†éš”)ï¼š**")
                chk_results = []
                chk_links = old_item_data.get("links", {})
                
                for i, chk_text in enumerate(item['check']):
                    col_chk, col_link = st.columns([3, 7])
                    with col_chk:
                        is_checked = st.checkbox(chk_text, key=f"chk_{item['id']}_{i}", value=old_item_data.get("checks", [False]*10)[i] if i < len(old_item_data.get("checks", [])) else False)
                        chk_results.append(is_checked)
                    with col_link:
                        raw_links = st.text_input("URL", value=chk_links.get(str(i), ""), key=f"lnk_{item['id']}_{i}", label_visibility="collapsed", placeholder="URL1, URL2...")
                        chk_links[str(i)] = raw_links
                        if raw_links:
                            link_list = [l.strip() for l in raw_links.split(",") if l.strip()]
                            btn_cols = st.columns(len(link_list))
                            for idx, link in enumerate(link_list):
                                with btn_cols[idx]:
                                    st.link_button(f"ğŸ“‚ æª”æ¡ˆ{idx+1}", link, use_container_width=True)
                
                # è©•åˆ†ç­‰ç´š
                st.divider()
                saved_score = old_item_data.get("score", "D")
                score_idx = ["A", "B", "C", "D"].index(saved_score)
                current_score = st.radio("è‡ªè©•ç­‰ç´š", ["A", "B", "C", "D"], index=score_idx, key=f"r_{item['id']}", horizontal=True)
                user_data[item['id']] = {"res": final_res, "score": current_score, "checks": chk_results, "links": chk_links}

    if st.button("ğŸ’¾ å„²å­˜æ‰€æœ‰é€²åº¦"):
        save_progress(user_data)
        st.toast("é€²åº¦å·²å„²å­˜æ–¼é›²ç«¯ï¼")

with tab_time:
    st.info("ğŸ•’ è¨ªè¦–æ™‚ç¨‹è¦åŠƒ (3.5 å°æ™‚) [cite: 50-51]ï¼š")
    schedule = [
        {"ç¨‹åº": "æœƒå‰æœƒ", "æ™‚é–“": "20min", "é‡é»": "å§”å“¡æºé€šå…±è­˜èˆ‡ç¢ºèªç¨‹åº"},
        {"ç¨‹åº": "è‡´è©ç°¡å ±", "æ™‚é–“": "20min", "é‡é»": "ç°¡å ± 15min (é™å°ˆå¸«è¨“ç·´é …ç›®)"},
        {"éšæ®µ": "å¯¦åœ°è§€å¯Ÿèˆ‡æ›¸å¯©", "æ™‚é–“": "130min", "é‡é»": "æ–‡ä»¶æ ¸å°èˆ‡é¢è«‡"},
        {"ç¨‹åº": "å›é¥‹å»ºè­°", "æ™‚é–“": "10min", "é‡é»": "å§”å“¡åˆæ­¥å›é¥‹èˆ‡è£œå……è³‡æ–™"}
    ]
    st.table(schedule)

# åˆ¤å®šé‚è¼¯ [cite: 68-70, 97-99]
total_items = len(all_data)
passed_count = sum(1 for d in user_data.values() if d['score'] in ['A', 'B', 'C'])
pass_rate = (passed_count / total_items) * 100
mandatory_failed = [id for id, d in user_data.items() if any(i['id'] == id and i['is_mandatory'] for i in all_data) and d['score'] == 'D']

st.sidebar.metric("ç¸½é”æˆç‡", f"{pass_rate:.1f}%")
if mandatory_failed:
    st.sidebar.error(f"âŒ ä¸åˆæ ¼ï¼šå¿…è¦é … D ({', '.join(mandatory_failed)})")
elif pass_rate >= 90:
    st.sidebar.success("âœ… ç¬¦åˆé€šéé–€æª»")
else:
    st.sidebar.warning(f"âš ï¸ æœªæ»¿ 90% (ç›®å‰ {passed_count}/{total_items})")
