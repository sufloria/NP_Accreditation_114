import streamlit as st
import json
import os

# ç¶²é é…ç½®ï¼šè¨­å®šæ¨™é¡Œèˆ‡å¯¬è¢å¹•ä½ˆå±€
st.set_page_config(page_title="114å¹´å°ˆå¸«èªå®šè‡ªæª¢ç³»çµ±-çµ‚æ¥µå®Œæ•´ç‰ˆ", layout="wide")

# 1. æ ¸å¿ƒè³‡æ–™åº«ï¼šå®Œæ•´ 23 é …æ¢æ–‡ã€ä½è­‰ç´°é …ã€è¨ªè«‡æ¨¡æ“¬é¡Œèˆ‡è©³ç´°æŒ‡å¼•
def get_full_criteria():
    return [
        # --- ç¬¬ä¸€ç« ï¼šæ•™å­¸è³‡æºèˆ‡çµ„ç¹”ç®¡ç† ---
        {"id": "1.1.1", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "å°ˆè²¬åŸ¹è‚²èˆ‡ç®¡ç†å–®ä½", "c_level": "å‰¯é™¢é•·ç´šå¬é›†äººï¼Œé†«è­·å…±åŒçµ„æˆï¼Œæ¯3å€‹æœˆé–‹æœƒ1æ¬¡ã€‚", "check": ["çµ„ç¹”æ¶æ§‹åœ–(å«å‰¯é™¢é•·ã€å°ˆå¸«ä»£è¡¨)", "æœƒè­°ç´€éŒ„(è¿‘ä¸€å¹´4ä»½)", "å‹å‹•æ¬Šç›Šç¶­è­·æªæ–½ç´€éŒ„"], "q": "å°ˆè²¬å–®ä½å¤šä¹…é–‹ä¸€æ¬¡æœƒï¼Ÿå¬é›†äººç´šåˆ¥ç‚ºä½•ï¼Ÿ"},
        {"id": "1.1.2", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "åŸ·æ¥­å…§å®¹è¨‚å®šèˆ‡å…¬å‘Š", "c_level": "è¨‚å®šåˆ†ç§‘åŸ·æ¥­ç¯„åœï¼Œå…¬å‘Šå‘¨çŸ¥ä¸¦è½å¯¦ã€‚", "check": ["å„åˆ†ç§‘åŸ·æ¥­è¦ç¯„", "å·¥ä½œå¥‘ç´„æ›¸(æˆ–æˆæ¬Šæ–‡ä»¶)", "é†«é™¢å…¬å‘Šå‘¨çŸ¥è­‰æ˜"], "q": "å¦‚ä½•ç¢ºä¿å°ˆå¸«åŸ·è¡Œæ¥­å‹™ä¸è¶…å‡ºæœ€æ–°è¾¦æ³•ä¹‹é™„è¡¨ç¯„åœï¼Ÿ"},
        {"id": "1.1.3", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "é ç«‹é†«ç™‚æµç¨‹(PMP) SOP", "c_level": "é†«å¸«é ˆæ–¼24å°æ™‚å…§å®Œæˆæ ¸å°åŠç°½ç½²ã€‚", "check": ["é ç«‹é†«ç™‚æµç¨‹ SOP", "24å°æ™‚å…§é†«å¸«æ ¸ç°½ç´€éŒ„", "å§”å“¡æœƒåå–®"], "q": "åŸ·è¡Œ PMP å¾Œï¼Œç›£ç£é†«å¸«æ˜¯å¦ç¢ºå¯¦æ–¼ 24 å°æ™‚å…§è£œç°½åï¼Ÿ"},
        {"id": "1.1.4", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "ç—…æ­·æ›¸å¯«å¯©æŸ¥æ©Ÿåˆ¶", "c_level": "ä¸»æ²»é†«å¸«å°å°ˆå¸«ç—…æ­·è¨˜è¼‰çµ¦äºˆæŒ‡å°ã€‚", "check": ["ç—…æ­·æ›¸å¯«å¯©æŸ¥æ©Ÿåˆ¶è¦ç¯„", "é†«å¸«æŒ‡å°ç—•è·¡æˆ–å¯©æŸ¥ç´€éŒ„"], "q": "ä¸»æ²»é†«å¸«å¦‚ä½•å°ä½ çš„ç—…æ­·è¨˜è¼‰çµ¦äºˆå…·é«”æŒ‡å°ï¼Ÿ"},
        {"id": "1.1.5", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "è‡¨åºŠåŸ·æ¥­å“è³ªç›£æ¸¬", "c_level": "è¨‚æœ‰ç›£æ¸¬è¦ç¯„åŠæ©Ÿåˆ¶ä¸¦æä¾›ä½è­‰ã€‚", "check": ["å“è³ªç›£æ¸¬è¾¦æ³•", "ç›£æ¸¬æŒ‡æ¨™èˆ‡ä½è­‰"], "q": "é†«é™¢å¦‚ä½•ç›£æ¸¬å°ˆå¸«çš„åŸ·æ¥­å“è³ªï¼Ÿ"},
        {"id": "1.1.6", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "å°ˆç§‘è­·ç†å¸«è€ƒæ ¸æ©Ÿåˆ¶", "c_level": "é†«è­·éƒ¨é–€å…±åŒè² è²¬è€ƒæ ¸ã€‚", "check": ["å°ˆç§‘è­·ç†å¸«è€ƒæ ¸è¦ç¯„", "é†«è­·å…±åŒè€ƒæ ¸ç´€éŒ„"], "q": "è€ƒè©•æ˜¯å¦è½å¯¦ç”±è­·ç†èˆ‡é†«ç™‚éƒ¨ä¸»ç®¡å…±åŒé€²è¡Œï¼Ÿ"},
        {"id": "1.2.1", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "å¦¥é©çš„è¨“ç·´å ´æ‰€", "c_level": "æä¾›å…¼é¡§éš±ç§ã€å®‰å…¨ä¹‹å ´æ‰€ã€‚", "check": ["è‡¨åºŠè¨“ç·´å ´æ‰€ç©ºé–“", "å·¥ä½œå®‰å…¨å¥åº·ç…§è­·ç­–ç•¥"], "q": "å¯¦åœ°è§€å¯Ÿå ´æ‰€æ˜¯å¦å…¼é¡§ç—…äººå®‰å…¨èˆ‡éš±ç§ï¼Ÿ"},
        {"id": "1.2.2", "is_mandatory": True, "chapter": "ç¬¬ä¸€ç« ", "title": "å¿…é ˆä¹‹è¨“ç·´è¨­å‚™", "c_level": "æä¾›ç¶²è·¯å¹³å°èˆ‡æ–‡ç»æª¢ç´¢ç­‰è¨­å‚™ã€‚", "check": ["è¨“ç·´è¨­å‚™ç’°å¢ƒ", "ç¶²è·¯å­¸ç¿’å¹³å°"], "q": "è‡¨åºŠå–®ä½æ˜¯å¦èƒ½éš¨æ™‚ä½¿ç”¨å­¸ç¿’å¹³å°èˆ‡æ–‡ç»åº«ï¼Ÿ"},
        {"id": "1.2.3", "is_mandatory": False, "chapter": "ç¬¬ä¸€ç« ", "title": "åœ–æ›¸èˆ‡æœŸåˆŠç®¡ç†", "c_level": "æä¾›è¿‘5å¹´å…§åœ–æ›¸åŠæœŸåˆŠã€‚", "check": ["è³‡æºæ¸…å–®", "æ–°è³¼å…¥å…¬å‘Šç´€éŒ„"], "q": "æ˜¯å¦äº†è§£æ–°è³¼åœ–æ›¸æœŸåˆŠä¹‹å…¬å‘Šç®¡é“ï¼Ÿ"},

        # --- ç¬¬äºŒç« ï¼šæ•™å­¸å¸«è³‡ã€åŸ¹è‚²èˆ‡ç¹¼çºŒæ•™è‚² ---
        {"id": "2.1.1", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "è‡¨åºŠå¸«è³‡-é†«å¸«è³‡æ ¼", "c_level": "å°ˆç§‘é†«å¸«å¯¦éš›å¾äº‹å°ˆç§‘å·¥ä½œè‡³å°‘2å¹´ã€‚", "check": ["é†«å¸«è­‰æ›¸å½±æœ¬", "å¹´è³‡æœå‹™è­‰æ˜"], "q": "åƒèˆ‡åŸ¹è¨“ä¹‹æŒ‡å°é†«å¸«è³‡æ­·æ˜¯å¦ç¬¦åˆè¦ç¯„ï¼Ÿ"},
        {"id": "2.1.2", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "è‡¨åºŠå¸«è³‡-å°ˆå¸«è³‡æ ¼", "c_level": "å…·å°ˆå¸«è³‡æ ¼ä¸”å¾äº‹å°ˆç§‘å·¥ä½œè‡³å°‘2å¹´ã€‚", "check": ["å°ˆå¸«è­‰æ›¸å½±æœ¬", "å°ˆå¸«æœå‹™è­‰æ˜"], "q": "æ“”ä»»æ•™å¸«ä¹‹å°ˆå¸«æ˜¯å¦çš†å…·å‚™ 2 å¹´ä»¥ä¸Šè³‡æ­·ï¼Ÿ"},
        {"id": "2.1.3", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "é…ç½®æ¯”èˆ‡å“è³ª", "c_level": "é†«å¸«:å°ˆå¸«:å­¸å“¡æ¯”ä¾‹é ˆç¬¦åˆ 1:4:4ã€‚", "check": ["å¸«ç”Ÿé…ç½®æ¯”ä¾‹çµ±è¨ˆè¡¨", "å¸«è³‡è©•å€¼ç´€éŒ„"], "q": "ç›®å‰å„å–®ä½ä¹‹å¸«ç”Ÿæ¯”æ˜¯å¦ç¬¦åˆ 1:4:4ï¼Ÿ"},
        {"id": "2.2.1", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "å¸«è³‡åŸ¹è‚²åˆ¶åº¦", "c_level": "æ˜è¨‚åŸ¹è‚²åˆ¶åº¦ã€è¨ˆç•«èˆ‡é€²ä¿®æ´»å‹•ã€‚", "check": ["å¸«è³‡ç™¼å±•è¨ˆç•«æ›¸", "æ•™å¸«åƒèˆ‡é€²ä¿®ç´€éŒ„"], "q": "é†«é™¢å¦‚ä½•åŸ¹è‚²å¸«è³‡çš„æ•™å­¸èƒ½åŠ›ï¼Ÿ"},
        {"id": "2.2.2", "is_mandatory": False, "chapter": "ç¬¬äºŒç« ", "title": "å¸«è³‡æ•™å­¸èƒ½åŠ›æå‡", "c_level": "æ•™å¸«èª²ç¨‹è‡³å°‘4å°æ™‚ï¼Œåƒèˆ‡ç‡100%ã€‚", "check": ["æ•™å¸«åƒèˆ‡æ•™å­¸èª²ç¨‹ç´€éŒ„", "æˆæ•ˆè©•ä¼°ç´€éŒ„"], "q": "æŒ‡å°æ•™å¸«ä»Šå¹´æ˜¯å¦çš†å®Œæˆ 4 å°æ™‚è¨“ç·´ï¼Ÿ"},
        {"id": "2.2.3", "is_mandatory": True, "chapter": "ç¬¬äºŒç« ", "title": "å°ˆå¸«ç¹¼çºŒæ•™è‚²åˆ¶åº¦", "c_level": "æ¯å¹´è‡³å°‘è¾¦ç†20å°æ™‚æ•™è‚²èª²ç¨‹ã€‚", "check": ["ç¹¼çºŒæ•™è‚²è¨“ç·´è¨ˆç•«", "é€²éšåˆ¶åº¦åŸ·è¡Œç´€éŒ„"], "q": "èª²ç¨‹å®‰æ’æ˜¯å¦è¶³ä»¥ç¶­æŒå°ˆå¸«è­‰ç…§æ•ˆæœŸï¼Ÿ"},

        # --- ç¬¬ä¸‰ç« ï¼šæ•™å­¸è¨“ç·´è¨ˆç•«èˆ‡åŸ·è¡Œæˆæœ ---
        {"id": "3.1.1", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "è¨“ç·´è¨ˆç•«å…§å®¹å…·é«”", "c_level": "å«ç›®çš„ã€ç›®æ¨™ã€èª²ç¨‹ã€å“è³ªç¶­è­·åŠè©•å€¼ã€‚", 
         "check": ["2023-2026 åŸ¹è¨“è¨ˆç•«æ›¸", "å„å¹´åº¦åˆ†ç§‘èª²ç¨‹æ¶æ§‹", "å¹´åº¦è¨ˆç•«æª¢è¨æœƒè­°ç´€éŒ„"], "q": "è«‹ç°¡å–®èªªæ˜è¨“ç·´è¨ˆç•«å¦‚ä½•ç¢ºä¿æ•™å­¸å“è³ªï¼Ÿ"},
        {"id": "3.1.2", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "æ•™å­¸èª²ç¨‹å…§å®¹å®‰æ’", "c_level": "åˆç†å…¼é¡§å­¸ç¿’èˆ‡å·¥ä½œéœ€è¦ï¼Œå…·è£œè¨“æ©Ÿåˆ¶ã€‚", 
         "check": ["å„å¹´åº¦èª²ç¨‹è¡¨(2022-2026)", "é–‹è¨“èªªæ˜æœƒç°¡å ±æˆ–ç°½åˆ°", "è£œè€ƒ/è£œå ±è¨»è¨˜ç´€éŒ„"], "q": "å­¸å“¡çš„å·¥ä½œé‡æ˜¯å¦æœƒå½±éŸ¿ä¸Šèª²é€²åº¦ï¼Ÿ"},
        {"id": "3.2.1", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "è¨“ç·´èª²ç¨‹ç¬¦åˆè¦å®š", "c_level": "ç¬¦åˆå°ˆç§‘è­·ç†å¸«åˆ†ç§‘åŠç”„å¯©è¾¦æ³•ã€‚", 
         "check": ["è¨“ç·´è¨ˆç•«æ›¸æ³•è¦é …å°ç…§", "èª²ç¨‹æ•™æã€ç°½åˆ°ç´€éŒ„", "èª²å®¤æˆæœè©•å€¼ç´€éŒ„"], "q": "å¦‚ä½•æ ¸å°ç›®å‰çš„èª²ç¨‹ç¬¦åˆä¸­å¤®æ³•è¦è¦æ±‚ï¼Ÿ"},
        {"id": "3.2.2", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "è‡¨åºŠå¯¦å‹™è¨“ç·´è½å¯¦", "c_level": "åæ˜ å­¸ç¿’ç›®æ¨™ï¼Œå…·æª¢è¨æ”¹å–„æ©Ÿåˆ¶ã€‚", 
         "check": ["è‡¨åºŠè¨“ç·´è¦åŠƒèˆ‡è©•å€¼è¡¨", "è‡¨åºŠæ¡ˆä¾‹æˆæœæ‘˜è¦", "é›™å‘å›é¥‹æœƒè­°ç´€éŒ„"], "q": "è€å¸«å¦‚ä½•åœ¨è‡¨åºŠä¸Šç¢ºèªå­¸å“¡çš„å­¸ç¿’æˆæ•ˆï¼Ÿ"},
        {"id": "3.3.1", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "å›é¥‹èˆ‡åæ˜ ç®¡é“", "c_level": "æ•™å¸«å³æ™‚å›é¥‹ä¸¦ç´€éŒ„ï¼Œè¨­æœ‰åæ˜ ç®¡é“ã€‚", 
         "check": ["å€‹åˆ¥å­¸å“¡è¼”å°ç´€éŒ„(ç‹å®¥å‹³)", "é›™å‘å›é¥‹æœƒè­°ç´€éŒ„"], "q": "å­¸å“¡é‡åˆ°ä¸åˆç†å¾…é‡æ™‚æœ‰å“ªäº›åæ˜ çª—å£ï¼Ÿ"},
        {"id": "3.3.2", "is_mandatory": False, "chapter": "ç¬¬ä¸‰ç« ", "title": "æ•™å¸«å¤šå…ƒåŒ–è©•ä¼°", "c_level": "è¨‚æœ‰æ•™å¸«è©•ä¼°æ©Ÿåˆ¶ä¸¦è½å¯¦å›é¥‹ã€‚", 
         "check": ["æ•™å¸«æ•™å­¸æˆæ•ˆè©•ä¼°æ©Ÿåˆ¶", "èª²ç¨‹æˆæœè©•å€¼å½™æ•´è³‡æ–™", "æ•™å¸«æ•™å­¸èª¿æ•´ç´€éŒ„"], "q": "å­¸å“¡å¦‚ä½•è©•ä¼°è€å¸«ï¼Ÿçµæœæ˜¯å¦çµ¦äºˆè€å¸«å»ºè­°ï¼Ÿ"},
        {"id": "3.3.3", "is_mandatory": False, "chapter": "ç¬¬ä¸‰ç« ", "title": "è¨“ç·´æˆæœåˆ†ææ”¹å–„", "c_level": "åˆ†ææˆæœä¸¦è¨‚æœ‰è¼”å°æ”¹å–„æªæ–½ã€‚", 
         "check": ["è¨“ç·´æˆæœåˆ†æå ±å‘Š", "æˆæ•ˆä¸ä½³è€…è¼”å°ç´€éŒ„"], "q": "è‹¥å­¸å“¡é™¢å…§æ¸¬è©¦ä¸éï¼Œæœ‰ä»€éº¼è£œå¼·æªæ–½ï¼Ÿ"},
        {"id": "3.3.4", "is_mandatory": True, "chapter": "ç¬¬ä¸‰ç« ", "title": "è¨“ç·´è¨ˆç•«æˆæ•ˆè©•ä¼°", "c_level": "è¨‚æœ‰è©•å€¼è¨ˆç•«ä¸”æ¯å¹´æª¢è¨(å«è€ƒç…§ç‡)ã€‚", 
         "check": ["è¨ˆç•«è©•å€¼åˆ†æå ±å‘Š", "è€ƒç…§é€šéç‡è¶¨å‹¢åˆ†æ", "æ”¹å–„æªæ–½è¿½è¹¤è¡¨"], "q": "å»å¹´è€ƒæ¥­ç‡å¦‚ä½•ï¼Ÿå¦‚ä½•ä¾æ­¤ä¿®è¨‚æ•™å­¸è¨ˆç•«ï¼Ÿ"}
    ]

# é€²åº¦å­˜å–é‚è¼¯
SAVE_FILE = 'progress.json'
def load_progress():
    if os.path.exists(SAVE_FILE):
        try:
            with open(SAVE_FILE, 'r', encoding='utf-8') as f: return json.load(f)
        except: return {}
    return {}

def save_progress(progress):
    with open(SAVE_FILE, 'w', encoding='utf-8') as f: json.dump(progress, f, ensure_ascii=False)

# --- ä»‹é¢å‘ˆç¾ ---
st.title("ğŸ¥ 114å¹´åº¦å°ˆç§‘è­·ç†å¸«è¨“ç·´é†«é™¢èªå®š-çµ‚æ¥µè‡ªæª¢ç³»çµ±")
st.markdown("æœ¬ç³»çµ±ç”±å­¸è¡“çµ„é•·é–‹ç™¼ï¼Œæ•´åˆ 23 é …èªå®šæ¢æ–‡ã€ä½è­‰æ¸…å–®ã€è¨ªè«‡é¡ŒåŠè‡ªè©•è¡¨åŸ·è¡Œå…§å®¹ã€‚")

all_data = get_full_criteria()
saved_progress = load_progress()
user_data = {}

# å´é‚Šæ¬„ï¼šåˆ¤å®šçµæœ
st.sidebar.header("ğŸ“Š èªå®šåˆ¤å®šçµæœ")

tab_chk, tab_time = st.tabs(["ğŸ“‹ å®Œæ•´æ¢æ–‡èˆ‡ä½è­‰æ ¸å°", "â±ï¸ è¨ªè¦–ç•¶æ—¥æ™‚ç¨‹è¡¨"])

with tab_chk:
    for chap_name in ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« "]:
        st.subheader(f"ğŸ“ {chap_name}")
        chap_data = [d for d in all_data if d['chapter'] == chap_name]
        for item in chap_data:
            badge = " (å¿…)" if item['is_mandatory'] else ""
            with st.expander(f"{item['id']} {item['title']}{badge}"):
                st.write(f"**ã€Cç­‰ç´šæ¨™æº–ã€‘**ï¼š{item['c_level']}")
                st.warning(f"ğŸ¤ {item['q']}")
                
                old_item_data = saved_progress.get(item['id'], {})
                
                # è² è²¬äººé¸æ“‡ (é¸å–® + æ‰‹å‹•è¼¸å…¥)
                roles = ["æœªæŒ‡æ´¾", "è¡Œæ”¿çµ„", "æ•™å­¸çµ„", "è‡¨åºŠçµ„", "å­¸è¡“çµ„é•·", "å…¶ä»–"]
                saved_res = old_item_data.get("res", "æœªæŒ‡æ´¾")
                def_idx = roles.index(saved_res) if saved_res in roles else 5
                
                c1, c2 = st.columns([1, 1])
                with c1:
                    sel_role = st.selectbox(f"ğŸ‘¤ è² è²¬äºº ({item['id']})", roles, index=def_idx, key=f"sel_{item['id']}")
                    final_res = sel_role
                    if sel_role == "å…¶ä»–" or (saved_res and saved_res not in roles):
                        final_res = st.text_input("âœï¸ å¡«å¯«å§“å", value=saved_res if saved_res not in roles else "", key=f"res_{item['id']}")
                
                # ä½è­‰ç´°é …èˆ‡å¤šé€£çµåŠŸèƒ½
                st.write("**ğŸ“‘ è©³ç´°ä½è­‰æ ¸å° (å¤šé€£çµè«‹ç”¨è‹±æ–‡é€—è™Ÿ , åˆ†éš”)ï¼š**")
                chk_results = []
                chk_links = old_item_data.get("links", {})
                for i, chk_text in enumerate(item['check']):
                    col_chk, col_link = st.columns([4, 6])
                    with col_chk:
                        is_checked = st.checkbox(chk_text, key=f"chk_{item['id']}_{i}", value=old_item_data.get("checks", [False]*15)[i] if i < len(old_item_data.get("checks", [])) else False)
                        chk_results.append(is_checked)
                    with col_link:
                        raw_links = st.text_input("URL", value=chk_links.get(str(i), ""), key=f"lnk_{item['id']}_{i}", label_visibility="collapsed", placeholder="è²¼ä¸Šä½è­‰é€£çµ")
                        chk_links[str(i)] = raw_links
                        if raw_links:
                            link_list = [l.strip() for l in raw_links.split(",") if l.strip()]
                            btn_cols = st.columns(len(link_list))
                            for idx, link in enumerate(link_list):
                                with btn_cols[idx]:
                                    st.link_button(f"ğŸ“‚ æª”æ¡ˆ{idx+1}", link, use_container_width=True)
                
                # è©•åˆ†ç­‰ç´š
                st.divider()
                saved_score = old_item_data.get("score", "D")
                score_idx = ["A", "B", "C", "D"].index(saved_score)
                current_score = st.radio("è‡ªè©•ç­‰ç´š", ["A", "B", "C", "D"], index=score_idx, key=f"r_{item['id']}", horizontal=True)
                user_data[item['id']] = {"res": final_res, "score": current_score, "checks": chk_results, "links": chk_links}

    if st.button("ğŸ’¾ å„²å­˜æ‰€æœ‰é€²åº¦"):
        save_progress(user_data)
        st.toast("è³‡æ–™å·²å„²å­˜ï¼")

with tab_time:
    st.info("ğŸ•’ è¨ªè¦–ç•¶å¤©æµç¨‹ç¸½è¨ˆ 3.5 å°æ™‚ï¼š")
    st.table([
        {"éšæ®µ": "æœƒå‰æœƒ", "æ™‚é–“": "20 min", "èªªæ˜": "è¨ªè¦–å§”å“¡å…ˆè¡Œæºé€šå…±è­˜"},
        {"éšæ®µ": "è‡´è©èˆ‡ç°¡å ±", "æ™‚é–“": "20 min", "èªªæ˜": "ç°¡å ± 15minï¼Œé ˆé™å®šæ–¼å°ˆå¸«è¨“ç·´è¨ˆç•«"},
        {"éšæ®µ": "å¯¦åœ°/æ›¸å¯©/è¨ªè«‡", "æ™‚é–“": "130 min", "èªªæ˜": "æ–‡ä»¶å¯©æŸ¥ã€è‡¨åºŠè§€å¯Ÿã€äººå“¡è¨ªè«‡"},
        {"éšæ®µ": "æ•´ç†èˆ‡å›é¥‹", "æ™‚é–“": "40 min", "èªªæ˜": "å…±è­˜é”æˆèˆ‡æ„è¦‹äº¤æµå›é¥‹"}
    ])

# èªå®šåˆ¤å®šé‚è¼¯  [cite: 16, 17, 68-70, 97-99]
total_items = len(all_data)
passed_count = sum(1 for d in user_data.values() if d['score'] in ['A', 'B', 'C'])
pass_rate = (passed_count / total_items) * 100
mandatory_failed = [id for id, d in user_data.items() if any(i['id'] == id and i['is_mandatory'] for i in all_data) and d['score'] == 'D']

st.sidebar.metric("é”æˆç‡", f"{pass_rate:.1f}%")
if mandatory_failed:
    st.sidebar.error(f"âŒ ä¸åˆæ ¼ï¼šå¿…è¦é … D ({', '.join(mandatory_failed)})")
    st.sidebar.write("âš ï¸ å¿…è¦é …é ˆ 100% é” C ç­‰ç´šä»¥ä¸Šæ‰èƒ½é€šéã€‚ [cite: 17]")
elif pass_rate >= 90:
    st.sidebar.success("âœ… ç¬¦åˆé€šéé–€æª»")
else:
    st.sidebar.warning(f"âš ï¸ é”æˆç‡ä¸è¶³ 90% (ç›®å‰ {passed_count}/{total_items})ã€‚")

st.sidebar.divider()
st.sidebar.info("ğŸ’¡ é€šéé–€æª»ï¼šCç­‰ç´šä»¥ä¸Šç¸½æ•¸é” 90%ï¼Œä¸” 16 é …å¿…è¦æ¢æ–‡é ˆå…¨æ•¸é” C ä»¥ä¸Šã€‚ [cite: 16, 17]")
